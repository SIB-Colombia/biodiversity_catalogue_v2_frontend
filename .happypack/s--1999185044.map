{"version":3,"sources":["src/auth/index.js"],"names":["http","isAuthenticated","hasRole","me","signin","signup","logout","getToken","setToken","getUser","setUser","clean","rootMe","type","data","body","FormData","key","append","config","method","headers","console","log","server","local","then","response","json","_id","user","error","message","catch","token","err","window","location","reload","localStorage","getItem","TOKEN","setItem","Promise","reject","resolve","jsonState","USER","JSON","parse","stringify","clear"],"mappings":"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","file":"index.js","sourceRoot":"/home/leo/htdocs/biodiversity_catalogue_v2_frontend","sourcesContent":["import fetch from 'isomorphic-fetch';\nimport Const from '../const';\nvar rootMe = null;\n\n//Http\nexport function http(type, data) {\n\n  var body = new FormData();\n  if (data)\n    for (var key in data)\n      body.append(key, data[key]);\n\n  data = data\n    ? body\n    : null;\n\n  let config = {\n    method: type,\n    // mode: 'cors',\n    headers: {\n      'Authorization': `Bearer ${getToken()}`\n    },\n    body: data\n  }\n\n  return config;\n\n}\n\n//is authenticated\nexport function isAuthenticated() {\n  return getUser();\n}\n\n//has Role\nexport function hasRole() {}\n\n//Me\n\nexport function me() {\n\n  console.log('me');\n\n  return fetch(`${Const.server.local}/api/user/me`, http('GET')).then((response) => {\n    return response.json()\n  }).then((data) => {\n\n    if (data._id) {\n      return setUser(data).then(user => {\n        return user;\n      });\n    } else {\n      throw {error: data.message};\n    }\n\n  }).catch(err => {\n    clean();\n  })\n\n}\n\n//signin\nexport function signin(user) {\n  return fetch(`${Const.server.local}/auth/local`, http('POST', user)).then((response) => {\n    return response.json()\n  }).then((data) => {\n    if (data.token) {\n      return setToken(data).then(token => {\n        return token;\n      });\n    } else {\n      throw {error: data.message};\n    }\n  }).catch(err => {\n    return err;\n  })\n}\n\n//signup\nexport function signup(user) {\n  return fetch(`${Const.server.local}/api/user/register`, http('POST', user)).then((response) => {\n    return response.json()\n  }).then((data) => {\n    return data\n  }).catch(err => {\n    return err;\n  })\n}\n\n//logout\nexport function logout() {\n  clean();\n  window.location.reload();\n}\n\n//Get Token\nexport function getToken() {\n  return localStorage.getItem(Const.TOKEN);\n}\n\n//Set Token\nexport function setToken(data) {\n  // localStorage.setItem(Const.TOKEN, data.token);\n  try {\n    localStorage.setItem(Const.TOKEN, data.token);\n  } catch (err) {\n    return Promise.reject(err.message);\n  }\n  return Promise.resolve(data.token || null);\n}\n\n//Get User\nexport function getUser() {\n  // return new Promise(function(resolve, reject) {\n  //   let user = JSON.parse(localStorage.getItem(Const.USER));\n  //   setTimeout(function() {\n  //     resolve(rootMe || user);\n  //   }, 1000);\n  // })\n\n  let jsonState;\n\n  try {\n    jsonState = localStorage.getItem(Const.USER);\n  } catch (err) {\n    return Promise.reject(err.message);\n  }\n\n  return Promise.resolve(rootMe = JSON.parse(jsonState) || null);\n\n}\n\n//Set User\nexport function setUser(data) {\n  // rootMe = data;\n  // localStorage.setItem(Const.USER, JSON.stringify(data));\n\n  try {\n    localStorage.setItem(Const.USER, JSON.stringify(data));\n  } catch (err) {\n    return Promise.reject(err.message);\n  }\n\n  return Promise.resolve(rootMe = data || null);\n\n}\n\n//Clean\nexport function clean() {\n  localStorage.clear();\n}\n"]}