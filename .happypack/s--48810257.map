{"version":3,"sources":["src/auth/index.js"],"names":["http","isAuthenticated","hasRole","me","signin","signup","logout","getToken","setToken","getUser","setUser","clean","rootUser","type","data","body","FormData","key","append","then","method","headers","token","catch","Promise","resolve","reject","console","log","server","local","response","json","user","err","window","location","reload","localStorage","getItem","TOKEN","setItem","JSON","parse","USER","stringify","clear"],"mappings":"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","file":"index.js","sourceRoot":"/home/leo/htdocs/biodiversity_catalogue_v2_frontend","sourcesContent":["import fetch from 'isomorphic-fetch';\nimport Const from '../const';\nvar rootUser;\n\n//Http\nexport function http(type, data) {\n\n  var body = new FormData();\n  if (data)\n    for (var key in data)\n      body.append(key, data[key]);\n\n  data = data\n    ? body\n    : null;\n\n  return getToken().then(token => {\n    return {\n      method: type,\n      // mode: 'cors',\n      headers: {\n        'Authorization': `Bearer ${token}`\n      },\n      body: data\n    }\n  }).catch(err => {\n    return '';\n  })\n\n}\n\n//is authenticated\nexport function isAuthenticated() {\n  //return getUser() || false;\n  return new Promise(function(resolve, reject) {\n\n    console.log('hh', getUser());\n    resolve(getUser() || false)\n\n  })\n}\n\n//has Role\nexport function hasRole() {}\n\n//Me\nexport function me() {\n  return fetch(`${Const.server.local}/api/user/me`, http('GET')).then((response) => {\n    return response.json()\n  }).then((data) => {\n    return setUser(data);\n    // return data;\n  }).catch(err => {\n    clean();\n  })\n}\n\n//signin\nexport function signin(user) {\n  return fetch(`${Const.server.local}/auth/local`, http('POST', user)).then((response) => {\n    return response.json()\n  }).then((data) => {\n    // setToken(data);\n    // return data\n    return setToken(data);\n\n  }).catch(err => {\n    return err;\n  })\n}\n\n//signup\nexport function signup(user) {\n  return fetch(`${Const.server.local}/api/user/register`, http('POST', user)).then((response) => {\n    return response.json()\n  }).then((data) => {\n    return data\n  }).catch(err => {\n    return err;\n  })\n}\n\n//logout\nexport function logout() {\n  clean();\n  window.location.reload();\n}\n\n//Get Token\nexport function getToken() {\n\n  return new Promise(function(resolve, reject) {\n    resolve(localStorage.getItem(Const.TOKEN));\n  })\n\n}\n\n//Set Token\nexport function setToken(data) {\n\nconsole.log('3');\n  return new Promise(function(resolve, reject) {\n    localStorage.setItem(Const.TOKEN, data.token)\n    resolve(data);\n  })\n\n}\n\n//Get User\nexport function getUser() {\n\n  return new Promise(function(resolve, reject) {\n    let user = JSON.parse(localStorage.getItem(Const.USER));\n    resolve(rootUser || user)\n  })\n\n  // return rootUser || JSON.parse(localStorage.getItem(Const.USER));\n}\n\n//Set User\nexport function setUser(data) {\n  // rootUser = data;\n  // localStorage.setItem(Const.USER, JSON.stringify(data));\n  return new Promise(function(resolve, reject) {\n    rootUser = data;\n    resolve(localStorage.setItem(Const.USER, JSON.stringify(data)))\n  })\n\n}\n\n//Clean\nexport function clean() {\n  localStorage.clear();\n}\n"]}